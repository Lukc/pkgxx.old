#
## Include for CMake
#
# Needs $name, $version, $release and $source
# Can receive arguments from $cmake_opts, $dirname, $make, $make_opts 
# and $separate_build_dir
#

if ! has cmake ${includes[@]}; then
	# If we are here, this file has been requested for the tools it contains.
	
	function cmake_enable {
		local FLAG="$1"
		local CMAKE_OPT="$2"
		echo -n "-DENABLE_${CMAKE_OPT}="
		if use "$FLAG"; then
			echo "YES"
		else
			echo "NO"
		fi
		iuse=(${iuse[@]//$FLAG} $FLAG)
	}
	
	# We should better use the rest of the file after the recipe has finished
	# being parsed.
	includes=(cmake ${includes[@]//cmake})
	return 0
fi

case $version in
	devel|dev|trunk)
		: ${dirname:="$name"}
	;;
	*)
		: ${dirname:="$name-$version"}
	;;
esac

: ${separate_build_dir:="no"}

: ${make:="pkgmake"}

cmake_opts=(
	${prefix:+-DPREFIX=$prefix}
	${prefix:+-DCMAKE_INSTALL_PREFIX=$prefix}
	${sysconfdir:+-DSYSCONF_INSTALL_DIR=$sysconfdir}
	${libdir:+-DLIB_INSTALL_DIR=$libdir}
	${datarootdir:+-DDATAROOTDIR=$datarootdir}
	${bindir:+-DBINDIR=$bindir}
	${mandir:+-DMANDIR=$mandir}
	${docdir:+-DDOCDIR=$docdir}
	${cmake_opts[@]}
)

build() {
	cd $dirname
	if [[ "$separate_build_dir" = "yes" ]]; then
		mkdir __build__
		cd __build__
	fi
	cmake $SRC/$dirname ${cmake_opts[@]}
	$make ${make_opts[@]}
	$make DESTDIR=$PKG ${make_opts[@]} install
}

# vim: syntax=sh shiftwidth=4 tabstop=4
