#
## Include for CMake
#
# Needs $name, $version, $release and $source
# Can receive arguments from $cmake_opts, $dirname, $make, $make_opts 
# and $separate_build_dir
#

case $version in
	devel|dev|trunk)
		: ${dirname:="$name"}
	;;
	*)
		: ${dirname:="$name-$version"}
	;;
esac

: ${make:="pkgmake"}

cmake_opts=(
	-DPREFIX=$prefix
	-DCMAKE_INSTALL_DIR=$prefix
	-DSYSCONF_INSTALL_DIR=$sysconfdir
	-DLIB_INSTALL_DIR=$libdir
	-DDATAROOTDIR=$datarootdir
	-DBINDIR=$bindir
	-DMANDIR=$mandir
	${cmake_opts[@]}
)

build() {
	cd $dirname
	if [[ "$separate_build_dir" = "yes" ]]; then
		mkdir __build__
		cd __build__
	fi
	cmake $SRC/$name-$version
	$make ${make_opts[@]}
	$make DESTDIR=$PKG ${make_opts[@]} install
}

